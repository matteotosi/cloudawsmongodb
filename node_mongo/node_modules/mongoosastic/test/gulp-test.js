var mongoose = require('mongoose');
var config = require('./config');
var elasticsearch = require('elasticsearch');
var Tweet = require('./models/tweet');

describe('Gulp test', function() {

  before(function(done) {
    mongoose.connect(config.mongoUrl, done);
  });

  after(function(done) {
    mongoose.disconnect(done);
  });

  it('should stop tasks with no work', function(done) {
    done();
  });

  it('should stop tasks with elasticsearch', function(done) {
    var esClient = new elasticsearch.Client({
      deadTimeout: 0,
      keepAlive: false
    });

    esClient.ping({
      requestTimeout: 1000
    }, function(err) {
      if (err) {
        return done(err);
      }

      esClient.close();
      done();

    });

  });

  it('should stop tasks with mongoosastic plugin', function(done) {
    var tweet = new Tweet({
      user: 'jamescarr',
      message: 'Saying something I shouldnt'
    });
    tweet.save(function() {
      done();
    });

  });

});
